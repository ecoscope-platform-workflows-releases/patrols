{
  "properties": {
    "workflow_details": {
      "additionalProperties": false,
      "properties": {
        "name": {
          "title": "Workflow Name",
          "type": "string"
        },
        "description": {
          "default": "",
          "title": "Workflow Description",
          "type": "string"
        }
      },
      "required": [
        "name"
      ],
      "type": "object",
      "description": "Add information that will help to differentiate this workflow from another.",
      "title": "Workflow Details"
    },
    "er_client_name": {
      "additionalProperties": false,
      "properties": {
        "data_source": {
          "$ref": "#/$defs/EarthRangerConnection",
          "title": "",
          "description": "Select one of your configured data sources."
        }
      },
      "required": [
        "data_source"
      ],
      "type": "object",
      "title": "Data Source"
    },
    "time_range": {
      "additionalProperties": false,
      "properties": {
        "since": {
          "format": "date-time",
          "title": "Since",
          "type": "string",
          "description": "The start time"
        },
        "until": {
          "format": "date-time",
          "title": "Until",
          "type": "string",
          "description": "The end time"
        }
      },
      "required": [
        "since",
        "until"
      ],
      "type": "object",
      "description": "Choose the period of time to analyze.",
      "title": "Time Range"
    },
    "Patrol and Event Types": {
      "type": "object",
      "description": "Select the Patrol and Event types to be analyzed.",
      "ecoscope:task_group": true,
      "properties": {
        "er_patrol_types": {
          "additionalProperties": false,
          "properties": {
            "patrol_types": {
              "items": {
                "type": "string"
              },
              "title": "Patrol Types",
              "type": "array",
              "description": "list of UUID of patrol types"
            }
          },
          "required": [
            "patrol_types"
          ],
          "type": "object",
          "title": ""
        },
        "er_patrol_status": {
          "additionalProperties": false,
          "properties": {
            "status": {
              "default": null,
              "description": "List comprised of 'active'/'overdue'/'done'/'cancelled'",
              "ecoscope:advanced": true,
              "items": {
                "enum": [
                  "active",
                  "overdue",
                  "done",
                  "cancelled"
                ],
                "type": "string"
              },
              "title": "Status",
              "type": "array"
            }
          },
          "type": "object",
          "required": [],
          "title": ""
        },
        "patrol_events": {
          "additionalProperties": false,
          "properties": {
            "event_type": {
              "items": {
                "type": "string"
              },
              "title": "Event Types",
              "type": "array",
              "description": "List of event types by name"
            },
            "drop_null_geometry": {
              "default": false,
              "title": "Drop Null Geometry",
              "type": "boolean",
              "description": "Whether or not to keep events with no geometry data",
              "ecoscope:advanced": true
            }
          },
          "required": [
            "event_type"
          ],
          "type": "object",
          "title": ""
        }
      },
      "uiSchema": {
        "ui:order": [
          "er_patrol_types",
          "er_patrol_status",
          "patrol_events"
        ]
      }
    },
    "groupers": {
      "additionalProperties": false,
      "properties": {
        "groupers": {
          "default": null,
          "items": {
            "anyOf": [
              {
                "$ref": "#/$defs/ValueGrouper"
              },
              {
                "$ref": "#/$defs/TemporalGrouper"
              }
            ],
            "title": "Group by"
          },
          "title": " ",
          "type": "array",
          "description": "            Specify how the data should be grouped to create the views for your dashboard.\n            This field is optional; if left blank, all the data will appear in a single view.\n            "
        }
      },
      "type": "object",
      "required": [],
      "title": "Group Data"
    },
    "Preprocess patrol observations": {
      "type": "object",
      "description": "Preprocess patrol observations from EarthRanger.",
      "ecoscope:task_group": true,
      "properties": {
        "set_patrol_traj_color_column": {
          "additionalProperties": false,
          "properties": {
            "var": {
              "title": "Category",
              "type": "string",
              "oneOf": [
                {
                  "const": "patrol_type",
                  "title": "Patrol Type"
                },
                {
                  "const": "patrol_status",
                  "title": "Patrol Status"
                },
                {
                  "const": "patrol_subject",
                  "title": "Patrol Subject"
                },
                {
                  "const": "patrol_serial_number",
                  "title": "Patrol Serial Number"
                }
              ],
              "description": "Select a category to color and differentiate patrol trajectories.",
              "default": "patrol_type"
            }
          },
          "required": [
            "var"
          ],
          "type": "object",
          "title": "Style Trajectory By Category"
        },
        "patrol_traj": {
          "additionalProperties": false,
          "properties": {
            "trajectory_segment_filter": {
              "allOf": [
                {
                  "$ref": "#/$defs/TrajectorySegmentFilter"
                }
              ],
              "default": {
                "min_length_meters": 0.001,
                "max_length_meters": 10000,
                "min_time_secs": 1,
                "max_time_secs": 57600,
                "min_speed_kmhr": 0.0001,
                "max_speed_kmhr": 300
              },
              "title": "Trajectory Segment Filter",
              "description": "Trajectory Segments outside these bounds will be removed",
              "ecoscope:advanced": true
            }
          },
          "required": [],
          "type": "object",
          "title": "Transform Relocations to Trajectories"
        }
      },
      "uiSchema": {
        "ui:order": [
          "set_patrol_traj_color_column",
          "patrol_traj"
        ]
      }
    },
    "Preprocess patrol events": {
      "type": "object",
      "description": "Preprocess patrol events from EarthRanger.",
      "ecoscope:task_group": true,
      "properties": {
        "filter_patrol_events": {
          "additionalProperties": false,
          "properties": {
            "min_x": {
              "default": -180.0,
              "title": "Min X",
              "type": "number",
              "ecoscope:advanced": true
            },
            "max_x": {
              "default": 180.0,
              "title": "Max X",
              "type": "number",
              "ecoscope:advanced": true
            },
            "min_y": {
              "default": -90.0,
              "title": "Min Y",
              "type": "number",
              "ecoscope:advanced": true
            },
            "max_y": {
              "default": 90.0,
              "title": "Max Y",
              "type": "number",
              "ecoscope:advanced": true
            },
            "filter_point_coords": {
              "default": [],
              "items": {
                "$ref": "#/$defs/Coordinate"
              },
              "title": "Filter Point Coords",
              "type": "array",
              "ecoscope:advanced": true
            }
          },
          "required": [],
          "type": "object",
          "title": "Apply Coordinate Filter"
        }
      },
      "uiSchema": {
        "ui:order": [
          "filter_patrol_events"
        ]
      }
    },
    "base_map_defs": {
      "additionalProperties": false,
      "properties": {
        "base_maps": {
          "default": [
            {
              "layer_name": "TERRAIN",
              "url": "https://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}",
              "opacity": 1
            },
            {
              "layer_name": "SATELLITE",
              "url": "https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",
              "opacity": 0.5
            }
          ],
          "items": {
            "anyOf": [
              {
                "$ref": "#/$defs/OpenStreetMap"
              },
              {
                "$ref": "#/$defs/Roadmap"
              },
              {
                "$ref": "#/$defs/Satellite"
              },
              {
                "$ref": "#/$defs/Terrain"
              },
              {
                "$ref": "#/$defs/LandDx"
              },
              {
                "$ref": "#/$defs/Hillshade"
              },
              {
                "$ref": "#/$defs/CustomTileLayer"
              }
            ],
            "title": "Base Layer or Custom Layer"
          },
          "title": "Set Map Base Layers",
          "type": "array",
          "description": "Select tile layers to use as base layers in map outputs. The first layer in the list will be the bottommost layer displayed.",
          "ecoscope:advanced": true
        }
      },
      "type": "object",
      "required": [],
      "title": "Base Maps"
    },
    "Patrol events bar chart": {
      "type": "object",
      "description": "Create the patrol events bar chart.",
      "ecoscope:task_group": true,
      "properties": {
        "patrol_events_bar_chart": {
          "additionalProperties": false,
          "properties": {
            "time_interval": {
              "enum": [
                "year",
                "month",
                "week",
                "day",
                "hour"
              ],
              "title": "Time Interval",
              "type": "string",
              "description": "Sets the time interval of the x axis."
            }
          },
          "required": [
            "time_interval"
          ],
          "type": "object",
          "title": "Draw Time Series Bar Chart for Patrols Events"
        }
      },
      "uiSchema": {
        "ui:order": [
          "patrol_events_bar_chart"
        ]
      }
    },
    "Time Density Map": {
      "type": "object",
      "description": "Calculate time density from patrol trajectories and display it on a map.",
      "ecoscope:task_group": true,
      "properties": {
        "td": {
          "additionalProperties": false,
          "properties": {
            "pixel_size": {
              "default": 250.0,
              "title": "Pixel Size",
              "type": "number",
              "description": "Raster pixel size in meters."
            },
            "max_speed_factor": {
              "default": 1.05,
              "title": "Max Speed Factor",
              "type": "number",
              "ecoscope:advanced": true
            },
            "expansion_factor": {
              "default": 1.3,
              "title": "Expansion Factor",
              "type": "number",
              "ecoscope:advanced": true
            }
          },
          "required": [],
          "type": "object",
          "title": "Calculate Time Density from Trajectory"
        }
      },
      "uiSchema": {
        "ui:order": [
          "td"
        ]
      }
    }
  },
  "$defs": {
    "EarthRangerConnection": {
      "properties": {
        "name": {
          "title": "Data Source",
          "type": "string"
        }
      },
      "required": [
        "name"
      ],
      "title": "EarthRangerConnection",
      "type": "object"
    },
    "TemporalGrouper": {
      "oneOf": [
        {
          "const": "%Y",
          "title": "Year (example: 2024)"
        },
        {
          "const": "%B",
          "title": "Month (example: September)"
        },
        {
          "const": "%Y-%m",
          "title": "Year and Month (example: 2023-01)"
        },
        {
          "const": "%j",
          "title": "Day of the year as a number (example: 365)"
        },
        {
          "const": "%d",
          "title": "Day of the month as a number (example: 31)"
        },
        {
          "const": "%A",
          "title": "Day of the week (example: Sunday)"
        },
        {
          "const": "%H",
          "title": "Hour (24-hour clock) as number (example: 22)"
        },
        {
          "const": "%Y-%m-%d",
          "title": "Date (example: 2025-01-31)"
        }
      ],
      "title": "Time",
      "type": "string"
    },
    "ValueGrouper": {
      "oneOf": [
        {
          "const": "patrol_serial_number",
          "title": "Patrol Serial Number"
        },
        {
          "const": "patrol_type",
          "title": "Patrol Type"
        }
      ],
      "title": "Category",
      "type": "string"
    },
    "TrajectorySegmentFilter": {
      "properties": {
        "min_length_meters": {
          "default": 0.001,
          "description": "Minimum Segment Length in Meters",
          "ecoscope:advanced": true,
          "title": "Min Length Meters",
          "type": "number"
        },
        "max_length_meters": {
          "default": 10000,
          "description": "Maximum Segment Length in Meters",
          "ecoscope:advanced": true,
          "title": "Max Length Meters",
          "type": "number"
        },
        "min_time_secs": {
          "default": 1,
          "description": "Minimum Segment Duration in Seconds",
          "ecoscope:advanced": true,
          "title": "Min Time Secs",
          "type": "number"
        },
        "max_time_secs": {
          "default": 57600,
          "description": "Maximum Segment Duration in Seconds",
          "ecoscope:advanced": true,
          "title": "Max Time Secs",
          "type": "number"
        },
        "min_speed_kmhr": {
          "default": 0.0001,
          "description": "Minimum Segment Speed in Kilometers per Hour",
          "ecoscope:advanced": true,
          "title": "Min Speed Kmhr",
          "type": "number"
        },
        "max_speed_kmhr": {
          "default": 300,
          "description": "Maximum Segment Speed in Kilometers per Hour",
          "ecoscope:advanced": true,
          "title": "Max Speed Kmhr",
          "type": "number"
        }
      },
      "title": "TrajectorySegmentFilter",
      "type": "object"
    },
    "Coordinate": {
      "properties": {
        "x": {
          "title": "X",
          "type": "number"
        },
        "y": {
          "title": "Y",
          "type": "number"
        }
      },
      "required": [
        "x",
        "y"
      ],
      "title": "Coordinate",
      "type": "object"
    },
    "CustomTileLayer": {
      "properties": {
        "custom_url": {
          "default": "https://tile.openstreetmap.org/{z}/{x}/{y}.png",
          "description": "The URL of a publicly accessible tiled raster service.",
          "pattern": "https?:\\/\\/(www\\.)?[-a-zA-Z0-9@:%._\\+~#=]{1,256}\\.[a-zA-Z0-9()]{1,6}([-a-zA-Z0-9()@:%_\\+.~#?&//=\\{\\}]*)",
          "title": "Custom Layer URL",
          "type": "string"
        },
        "custom_opacity": {
          "default": 1,
          "description": "Set layer transparency from 1 (fully visible) to 0 (hidden).",
          "maximum": 1.0,
          "minimum": 0.0,
          "title": "Custom Layer Opacity",
          "type": "number"
        },
        "custom_max_zoom": {
          "default": null,
          "description": "Set the maximum zoom level to fetch tiles for.",
          "title": "Custom Layer Max Zoom",
          "type": "integer"
        },
        "custom_min_zoom": {
          "default": null,
          "description": "Set the minimum zoom level to fetch tiles for.",
          "title": "Custom Layer Min Zoom",
          "type": "integer"
        }
      },
      "title": "Custom Layer (Advanced)",
      "type": "object"
    },
    "Hillshade": {
      "properties": {
        "url": {
          "const": "https://server.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer/tile/{z}/{y}/{x}",
          "default": "https://server.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer/tile/{z}/{y}/{x}",
          "enum": [
            "https://server.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer/tile/{z}/{y}/{x}"
          ],
          "title": "Preset Layer URL",
          "type": "string"
        },
        "opacity": {
          "default": 1,
          "description": "Set layer transparency from 1 (fully visible) to 0 (hidden).",
          "maximum": 1.0,
          "minimum": 0.0,
          "title": "Layer Opacity",
          "type": "number"
        }
      },
      "title": "USGS Hillshade",
      "type": "object"
    },
    "LandDx": {
      "properties": {
        "url": {
          "const": "https://tiles.arcgis.com/tiles/POUcpLYXNckpLjnY/arcgis/rest/services/landDx_basemap_tiles_mapservice/MapServer/tile/{z}/{y}/{x}",
          "default": "https://tiles.arcgis.com/tiles/POUcpLYXNckpLjnY/arcgis/rest/services/landDx_basemap_tiles_mapservice/MapServer/tile/{z}/{y}/{x}",
          "enum": [
            "https://tiles.arcgis.com/tiles/POUcpLYXNckpLjnY/arcgis/rest/services/landDx_basemap_tiles_mapservice/MapServer/tile/{z}/{y}/{x}"
          ],
          "title": "Preset Layer URL",
          "type": "string"
        },
        "opacity": {
          "default": 1,
          "description": "Set layer transparency from 1 (fully visible) to 0 (hidden).",
          "maximum": 1.0,
          "minimum": 0.0,
          "title": "Layer Opacity",
          "type": "number"
        }
      },
      "title": "LandDx",
      "type": "object"
    },
    "OpenStreetMap": {
      "properties": {
        "url": {
          "const": "https://tile.openstreetmap.org/{z}/{x}/{y}.png",
          "default": "https://tile.openstreetmap.org/{z}/{x}/{y}.png",
          "enum": [
            "https://tile.openstreetmap.org/{z}/{x}/{y}.png"
          ],
          "title": "Preset Layer URL",
          "type": "string"
        },
        "opacity": {
          "default": 1,
          "description": "Set layer transparency from 1 (fully visible) to 0 (hidden).",
          "maximum": 1.0,
          "minimum": 0.0,
          "title": "Layer Opacity",
          "type": "number"
        }
      },
      "title": "Open Street Map",
      "type": "object"
    },
    "Roadmap": {
      "properties": {
        "url": {
          "const": "https://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}",
          "default": "https://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}",
          "enum": [
            "https://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}"
          ],
          "title": "Preset Layer URL",
          "type": "string"
        },
        "opacity": {
          "default": 1,
          "description": "Set layer transparency from 1 (fully visible) to 0 (hidden).",
          "maximum": 1.0,
          "minimum": 0.0,
          "title": "Layer Opacity",
          "type": "number"
        }
      },
      "title": "Roadmap",
      "type": "object"
    },
    "Satellite": {
      "properties": {
        "url": {
          "const": "https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",
          "default": "https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",
          "enum": [
            "https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}"
          ],
          "title": "Preset Layer URL",
          "type": "string"
        },
        "opacity": {
          "default": 1,
          "description": "Set layer transparency from 1 (fully visible) to 0 (hidden).",
          "maximum": 1.0,
          "minimum": 0.0,
          "title": "Layer Opacity",
          "type": "number"
        }
      },
      "title": "Satellite",
      "type": "object"
    },
    "Terrain": {
      "properties": {
        "url": {
          "const": "https://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}",
          "default": "https://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}",
          "enum": [
            "https://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}"
          ],
          "title": "Preset Layer URL",
          "type": "string"
        },
        "opacity": {
          "default": 1,
          "description": "Set layer transparency from 1 (fully visible) to 0 (hidden).",
          "maximum": 1.0,
          "minimum": 0.0,
          "title": "Layer Opacity",
          "type": "number"
        }
      },
      "title": "Terrain",
      "type": "object"
    }
  },
  "additionalProperties": false,
  "uiSchema": {
    "ui:order": [
      "workflow_details",
      "er_client_name",
      "time_range",
      "Patrol and Event Types",
      "groupers",
      "Preprocess patrol observations",
      "Preprocess patrol events",
      "base_map_defs",
      "Patrol events bar chart",
      "Time Density Map"
    ]
  }
}
